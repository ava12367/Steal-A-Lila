<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Steal-A-Lila â€” Profile</title>
<style>
  :root{
    --blue:#00b4ff;
    --hotpink:#ff2dd4;
    --neonyellow:#fff22b;
    --dark:#0b0710;
    --glass: rgba(255,255,255,0.04);
    --card: rgba(255,255,255,0.03);
    font-family: Inter, Roboto, system-ui, -apple-system, "Segoe UI", Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#ff2dd4 0%, #ff78c8 20%, #ffd6ed 40%); color:#0b0b0b;}
  /* tie-dye swirl overlay */
  .swirl {
    position:fixed; inset:0; z-index:-2;
    background:
      radial-gradient(800px 300px at 15% 20%, rgba(0,180,255,0.12), transparent 12%),
      radial-gradient(600px 360px at 80% 30%, rgba(255,242,43,0.09), transparent 12%),
      conic-gradient(from 150deg at 50% 50%, rgba(255,45,212,0.12), rgba(0,180,255,0.08), rgba(255,242,43,0.05));
    mix-blend-mode: screen;
    filter: blur(16px) saturate(1.05);
    opacity:0.98;
  }

  /* header */
  header{
    display:flex;align-items:center;justify-content:space-between;padding:12px 20px;position:relative;
    backdrop-filter: blur(6px); 
  }
  .profile{
    display:flex;gap:12px;align-items:center;
  }
  .avatar{
    width:64px;height:64px;border-radius:14px;background:linear-gradient(135deg,var(--hotpink),var(--blue));
    display:grid;place-items:center;font-weight:800;color:white;font-size:24px;border:3px solid rgba(255,255,255,0.12);
  }
  .profile .info{line-height:1}
  .profile .name{font-weight:900}
  .profile .handle{font-size:12px;color:rgba(11,11,11,0.7)}

  .search-wrap{position:absolute;left:50%;transform:translateX(-50%);top:14px;width:min(760px,70%);}
  .search{
    display:flex;gap:8px;align-items:center;padding:10px;border-radius:999px;background:rgba(255,255,255,0.88);
    box-shadow:0 6px 26px rgba(11,11,11,0.16);
  }
  .search input{flex:1;border:0;background:transparent;padding:8px 6px;font-size:15px;outline:none}
  .search button{background:linear-gradient(90deg,var(--blue),var(--hotpink));border:0;padding:8px 14px;border-radius:10px;color:white;font-weight:800;cursor:pointer}

  .right-controls{display:flex;gap:10px;align-items:center}
  .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.08);padding:8px 12px;border-radius:10px}
  .add-friend{background:linear-gradient(90deg,var(--hotpink),var(--neonyellow));padding:10px 14px;border-radius:12px;border:none;font-weight:900;cursor:pointer}

  main{display:flex;gap:18px;padding:18px;max-width:1400px;margin:40px auto 100px;align-items:start}
  /* left column */
  .col-left{width:320px;display:flex;flex-direction:column;gap:12px}
  .card{background:rgba(255,255,255,0.92);border-radius:16px;padding:14px;box-shadow:0 10px 30px rgba(11,11,11,0.12);}
  .small{font-size:13px;color:#222}

  /* center game area */
  .arena{
    flex:1;min-height:640px;border-radius:16px;padding:18px;position:relative;
    background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
    box-shadow:0 20px 60px rgba(11,11,11,0.12); overflow:hidden;
  }

  /* placeholder for realistic image.
     Replace #hero-img with a real image or high-quality illustration you have the rights to.
  */
  .hero-img {
    position:absolute; right:12px; top:12px; width:420px; height:420px; border-radius:14px;
    background:
      linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.06));
    display:grid;place-items:center; font-weight:800;color:#111;
    border:5px solid rgba(255,255,255,0.06);
    box-shadow:0 30px 80px rgba(11,11,11,0.25);
  }
  .hero-img .svg-placeholder{width:360px;height:360px}

  /* Bases layout */
  .bases{position:relative;width:100%;height:640px;display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(2,1fr);gap:8px;padding:12px}
  .base{
    background:linear-gradient(180deg, rgba(255,255,255,0.82), rgba(255,255,255,0.84));
    border-radius:12px;padding:10px;position:relative;overflow:hidden;border:1px solid rgba(11,11,11,0.06)
  }
  .base .label{position:absolute;left:50%;transform:translateX(-50%);top:6px;font-weight:900;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--blue),var(--hotpink));color:white;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
  .slots{display:grid;grid-template-columns:repeat(6,1fr);gap:6px; margin-top:42px}
  .slot{height:36px;border-radius:8px;background:linear-gradient(180deg,#fff,#ffe9ff);display:flex;align-items:center;justify-content:center;font-weight:800; font-size:11px;color:#222;border:1px dashed rgba(0,0,0,0.06);position:relative}
  .slot.empty{opacity:0.35}
  .slot .name{font-size:11px}

  .floating-username{position:absolute;top:40px;left:6px;font-weight:800;color:rgba(0,0,0,0.6)}

  /* coin and brainrot badges */
  .badge{display:inline-block;padding:6px 8px;border-radius:8px;font-weight:800}
  .coin{background:linear-gradient(90deg,var(--neonyellow),#ffe37a)}
  .brainrot{background:linear-gradient(90deg,var(--hotpink),var(--blue));color:white}

  /* lobby */
  .lobby{display:flex;gap:12px;align-items:center;justify-content:center;padding:18px;border-radius:12px;background:linear-gradient(90deg,rgba(0,180,255,0.12),rgba(255,45,212,0.12));color:#061; font-weight:900}

  /* bottom bar / HUD */
  .hud{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:linear-gradient(90deg,rgba(255,255,255,0.95),rgba(255,255,255,0.92));padding:10px 14px;border-radius:999px;box-shadow:0 14px 40px rgba(0,0,0,0.2)}
  .controls{display:flex;gap:8px;align-items:center}

  /* podium modal */
  .podium{
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.6));
  }
  .podium .box{background:white;padding:22px;border-radius:14px;width:90%;max-width:720px;text-align:center}
  .podium .place{font-weight:900;padding:12px 0;font-size:18px}
  .small-muted{font-size:12px;color:#333;margin-top:6px}

  /* responsive */
  @media (max-width:1000px){
    main{flex-direction:column;padding:12px}
    .hero-img{display:none}
    .col-left{width:100%}
  }
</style>
</head>
<body>

<div class="swirl" aria-hidden="true"></div>

<header>
  <div class="profile">
    <div class="avatar">L</div>
    <div class="info">
      <div class="name">Lila ðŸ’«</div>
      <div class="handle">@steal-a-lila</div>
    </div>
  </div>

  <div class="search-wrap" role="search" aria-label="Search">
    <div class="search">
      <input id="searchInput" placeholder="Search Steal-A-Lila servers, players and items...">
      <button id="searchBtn">Search</button>
    </div>
  </div>

  <div class="right-controls">
    <button class="btn-ghost">Messages</button>
    <button class="btn-ghost">Settings</button>
    <button class="add-friend">+ Add Friends</button>
  </div>
</header>

<main>
  <div class="col-left">
    <div class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div>
          <div style="font-weight:900">Profile</div>
          <div class="small">Steal-A-Brainrot theme</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:900;font-size:18px">Coins</div>
          <div id="myCoins" style="font-weight:900">0</div>
        </div>
      </div>
      <hr style="margin:10px 0">
      <div style="display:flex;gap:8px">
        <button class="btn-ghost" id="joinBtn">Join Queue</button>
        <button class="btn-ghost" id="leaveBtn" disabled>Leave</button>
      </div>
      <div style="margin-top:10px;">
        <div style="font-weight:900">Demo Controls</div>
        <div class="small">Use Demo Speed to speed the round for testing</div>
        <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
          <label class="small">Demo speed</label>
          <select id="speedSelect">
            <option value="1">Normal (1x)</option>
            <option value="10">10x</option>
            <option value="30" selected>30x (fast test)</option>
            <option value="120">120x</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card">
      <div style="font-weight:900">Lobby</div>
      <div id="lobbyBox" class="lobby" style="margin-top:8px">Waiting area â€¢ Steal-A-Lila â€¢ 0 / 6</div>
      <div style="margin-top:10px">
        <div style="font-weight:900">Players in Queue</div>
        <ul id="playerList" style="margin:8px 0;padding-left:16px"></ul>
      </div>
    </div>

    <div class="card small">
      <div style="font-weight:900;margin-bottom:8px">Rules / Notes</div>
      <ul>
        <li>Each round: 6 players, 15 minutes (real). Demo speed speeds it up for testing.</li>
        <li>Each base has 12 slots to hold brainrots.</li>
        <li>Lock your base (70s) to prevent stealing.</li>
        <li>Steal a brainrot by clicking on another player's brainrot; then return to your base and place it in an empty slot.</li>
        <li>Coins spawn on map; 5 points per coin. Use coins to buy brainrots.</li>
        <li>1st/2nd/3rd podium awards 50/25/15 coins.</li>
      </ul>
    </div>
  </div>

  <div class="arena card">
    <!-- hero image placeholder (replace with real image if you have it) -->
    <div class="hero-img" id="heroImg" title="Replace this with your realistic image if you own it">
      <!-- Simple stylized placeholder. Replace with <img src="your_image.jpg"> if you have rights. -->
      <svg class="svg-placeholder" viewBox="0 0 320 320" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Illustration placeholder">
        <defs>
          <linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#fff0c9"/><stop offset="1" stop-color="#ffd65a"/></linearGradient>
        </defs>
        <rect rx="18" width="320" height="320" fill="url(#g1)"/>
        <text x="50%" y="52%" dominant-baseline="middle" text-anchor="middle" font-size="18" font-weight="800" fill="#2b2b2b">Stylized portrait placeholder</text>
        <text x="50%" y="62%" dominant-baseline="middle" text-anchor="middle" font-size="11" fill="#2b2b2b">Replace this with your realistic image (must be user-owned)</text>
      </svg>
    </div>

    <!-- bases grid 6 -->
    <div class="bases" id="bases">
      <!-- bases rendered by JS -->
    </div>

    <div class="hud" role="status">
      <div class="controls">
        <div class="small">Game time left: <span id="timeLeft">â€”</span></div>
        <div style="width:10px"></div>
        <button class="btn-ghost" id="lockBaseBtn" title="Lock your base for 70s">Lock My Base</button>
        <button class="btn-ghost" id="buyBrainBtn">Buy Brainrot (5 coins)</button>
      </div>
    </div>

  </div>

</main>

<!-- podium modal -->
<div class="podium" id="podiumModal" role="dialog" aria-hidden="true">
  <div class="box">
    <div style="font-size:22px;font-weight:900">Round Results</div>
    <div id="podiumResults" style="margin-top:12px"></div>
    <div style="margin-top:18px"><button id="closePod" class="btn-ghost">Close</button></div>
  </div>
</div>

<script>
/* Simple in-browser demo game engine
   - Single-file demo suitable for GitHub Pages
   - Important: for production hooking up with real multiplayer backend is required.
*/

// CONFIG
const GAME_PLAYERS = 6;
const SLOTS_PER_BASE = 12;
const ROUND_SECONDS = 15 * 60; // 15 minutes real-time
const BASE_LOCK_SECONDS = 70;
const BRAINROT_COST = 5; // coins cost
const COIN_VALUE = 5; // each coin is 5 points (as requested)
const BRAINROT_SPAWN_SECONDS = 2; // new brainrots appear every 2s for purchase spawn pool (not auto assign)
const COIN_SPAWN_SECONDS = 3;
const COIN_LIFETIME = 60; // seconds
const BAT_LIFETIME = 40;

// Demo controls: speed multiplier from UI
let speedMultiplier = Number(document.getElementById('speedSelect').value) || 30; // default fast for demo

document.getElementById('speedSelect').addEventListener('change', e=>{
  speedMultiplier = Number(e.target.value);
});

// state
let my = {
  id: 'you',
  username: 'You',
  coins: 0,
  carrying: null, // {id,name,from}
  baseIndex: null // assigned once game starts
};

const players = []; // players currently in queue or in game
const queue = []; // queued players (for UI)
const bases = []; // base objects

const ui = {
  basesEl: document.getElementById('bases'),
  lobbyBox: document.getElementById('lobbyBox'),
  playerList: document.getElementById('playerList'),
  myCoins: document.getElementById('myCoins'),
  timeLeft: document.getElementById('timeLeft'),
  podiumModal: document.getElementById('podiumModal'),
  podiumResults: document.getElementById('podiumResults')
};

// helper utilities
function uid(prefix='id'){return prefix+Math.random().toString(36).slice(2,9)}
function randName(){ const a=['Lilaca','Buda','Baca','Snoopy','Mochi','Zuzu','Nori','Puffy','Tiki','Bibi','Riri','Kiki']; const b=['budabaca','fluff','drip','pop','blink','swirl','glint','sprout']; return a[Math.floor(Math.random()*a.length)]+' '+b[Math.floor(Math.random()*b.length)]+Math.floor(Math.random()*99)}

// initialize UI
function renderLobby(){
  ui.lobbyBox.textContent = `Waiting area â€¢ Steal-A-Lila â€¢ ${players.length} / ${GAME_PLAYERS}`;
  ui.playerList.innerHTML = '';
  players.forEach(p=>{
    const li = document.createElement('li');
    li.textContent = p.username + (p.id === my.id ? ' (You)' : '');
    ui.playerList.appendChild(li);
  });
  ui.myCoins.textContent = my.coins;
}

// create 6 bases
function initBases(){
  ui.basesEl.innerHTML = '';
  bases.length = 0;
  for(let i=0;i<GAME_PLAYERS;i++){
    const base = {
      index:i,
      id: 'base-'+i,
      owner: null, // assigned when players join the game
      lockedUntil: 0,
      slots: Array.from({length:SLOTS_PER_BASE}, ()=>null) // each slot: brainrot or null
    };
    bases.push(base);
    const baseEl = document.createElement('div');
    baseEl.className = 'base';
    baseEl.id = 'base-el-'+i;
    baseEl.innerHTML = `
      <div class="label" id="base-label-${i}">Base ${i+1}</div>
      <div class="floating-username" id="base-user-${i}">â€”</div>
      <div class="slots" id="slots-${i}"></div>
      <div style="position:absolute;right:8px;bottom:8px;display:flex;gap:6px">
        <div id="coins-${i}" class="badge coin small-muted">0</div>
        <button class="btn-ghost" id="stealbtn-${i}">Steal from this base</button>
      </div>
    `;
    ui.basesEl.appendChild(baseEl);

    // fill slots
    const slotsEl = baseEl.querySelector('#slots-'+i);
    for(let s=0;s<SLOTS_PER_BASE;s++){
      const slotEl = document.createElement('div');
      slotEl.className = 'slot empty';
      slotEl.id = `slot-${i}-${s}`;
      slotEl.innerHTML = `<div class="name">empty</div>`;
      slotsEl.appendChild(slotEl);

      // place action: if carrying brainrot, click to place it
      slotEl.addEventListener('click', ()=> {
        if(!my.carrying) return;
        if(base.owner && base.owner.id !== my.id) {
          alert('You can only place brainrots in your own base!');
          return;
        }
        // place if empty
        if(base.slots[s]) { alert('Slot occupied'); return;}
        base.slots[s] = my.carrying;
        // if placed, clear carrying
        my.carrying = null;
        updateSlotUI(i,s);
        renderHud();
      });
    }

    // steal button: choose a brainrot randomly from that base if available
    baseEl.querySelector('#stealbtn-'+i).addEventListener('click', ()=>{
      if(!isInGame(my.id)) { alert('You must be in the game to steal'); return; }
      if(bases[i].owner && bases[i].owner.id === my.id) { alert('Cannot steal from your own base'); return; }
      attemptStealFromBase(i);
    });
  }
}

// UI update helpers
function updateSlotUI(baseIndex, slotIndex){
  const slotEl = document.getElementById(`slot-${baseIndex}-${slotIndex}`);
  const slot = bases[baseIndex].slots[slotIndex];
  if(slot){
    slotEl.classList.remove('empty');
    slotEl.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><div class="brainrot badge brainrot">${slot.name.split(' ')[0]}</div><div class="name">${slot.name}</div></div>`;
    // mark that this slot can be stolen if base not locked
  } else {
    slotEl.classList.add('empty');
    slotEl.innerHTML = `<div class="name">empty</div>`;
  }
}

function renderBases(){
  bases.forEach((b,i)=>{
    const ownerName = b.owner ? b.owner.username : 'Unassigned';
    document.getElementById('base-user-'+i).textContent = b.owner ? b.owner.username : 'â€”';
    document.getElementById('base-label-'+i).textContent = (b.owner ? b.owner.username + "'s Base" : 'Base '+(i+1));
    // slots
    for(let s=0;s<SLOTS_PER_BASE;s++){
      updateSlotUI(i,s);
    }
    // coin count display (for demo: coins in base = number of brainrots * 5)
    const count = b.slots.filter(x=>x).length * COIN_VALUE;
    document.getElementById('coins-'+i).textContent = `${count} pts`;
  });
}

// simple check if a player is in current game
function isInGame(playerId){
  return players.some(p=>p.id===playerId && p.inGame);
}

// queue/join/leave logic
document.getElementById('joinBtn').addEventListener('click', ()=>{
  if(players.some(p=>p.id===my.id)) return;
  const p = {id:my.id, username:my.username, inGame:false, coins:0, score:0};
  players.push(p);
  renderLobby();
  tryStartIfReady();
});

document.getElementById('leaveBtn').addEventListener('click', ()=>{
  for(let i=0;i<players.length;i++){
    if(players[i].id===my.id){ players.splice(i,1); break; }
  }
  renderLobby();
  document.getElementById('leaveBtn').disabled = true;
});

// search button (UI only)
document.getElementById('searchBtn').addEventListener('click', ()=> {
  alert('Search demo: searches are not connected to a backend in this demo.');
});

// game engine loop & spawns
let tickInterval = null;
let lastTick = Date.now();
let roundEndTime = 0;
let roundRunning = false;
let spawnTimers = {coin:0,brain:0};

// start round when 6 players joined
function tryStartIfReady(){
  if(players.length >= GAME_PLAYERS && !roundRunning){
    // mark first GAME_PLAYERS as in-game
    for(let i=0;i<GAME_PLAYERS;i++){
      players[i].inGame = true;
      players[i].score = 0;
      // assign to bases
      bases[i].owner = players[i];
      players[i].baseIndex = i;
      // give each player a few brainrots initially
      for(let s=0;s<3 && s<SLOTS_PER_BASE;s++){
        const br = {id:uid('b'), name: randName(), ownerId: players[i].id};
        bases[i].slots[s] = br;
      }
    }
    // others (if more) remain queued â€” but for this demo we limit to exactly GAME_PLAYERS
    renderBases();
    roundStart();
  } else {
    renderLobby();
  }
}

// round start
function roundStart(){
  roundRunning = true;
  const now = Date.now();
  roundEndTime = now + (ROUND_SECONDS*1000)/speedMultiplier;
  spawnTimers = {coin:0,brain:0};
  lastTick = now;
  // enable leave button
  document.getElementById('leaveBtn').disabled = false;
  // if you are not in the game, but in players, add dummy bots to fill slots (for demo)
  if(!players.some(p=>p.id===my.id)){
    // add you as a spectator (if you didn't join)
    // no-op for now
  }
  // start tick
  if(tickInterval) clearInterval(tickInterval);
  tickInterval = setInterval(tick, 250); // game tick
  renderLobby();
}

// round end
function roundEnd(){
  roundRunning = false;
  if(tickInterval) clearInterval(tickInterval);
  // compute podium by score
  const ranking = players.filter(p=>p.inGame).slice().sort((a,b)=>b.score-a.score);
  if(ranking[0]) ranking[0].coins = (ranking[0].coins||0) + 50;
  if(ranking[1]) ranking[1].coins = (ranking[1].coins||0) + 25;
  if(ranking[2]) ranking[2].coins = (ranking[2].coins||0) + 15;
  // show podium results
  ui.podiumResults.innerHTML = '';
  ranking.slice(0,6).forEach((p,i)=>{
    const div = document.createElement('div');
    div.className = 'place';
    div.innerHTML = `<div style="font-weight:900">${i+1}. ${p.username || 'Player'}</div><div class="small-muted">Score: ${p.score || 0} â€¢ Coins: ${p.coins||0}</div>`;
    ui.podiumResults.appendChild(div);
  });
  ui.podiumModal.style.display = 'flex';
  ui.podiumModal.setAttribute('aria-hidden','false');

  // reset base owners and slots (clear)
  bases.forEach(b=>{
    b.owner = null;
    b.lockedUntil = 0;
    b.slots = Array.from({length:SLOTS_PER_BASE}, ()=>null);
  });
  renderBases();
  renderLobby();
  document.getElementById('leaveBtn').disabled = true;
}

// close podium
document.getElementById('closePod').addEventListener('click', ()=>{
  ui.podiumModal.style.display = 'none';
  ui.podiumModal.setAttribute('aria-hidden','true');
});

// main tick
function tick(){
  const now = Date.now();
  const dt = (now-lastTick)/1000 * speedMultiplier; // scaled seconds
  lastTick = now;
  if(roundRunning){
    // update timers, spawn coins & brainrot "shop" pool
    spawnTimers.coin += dt;
    spawnTimers.brain += dt;
    if(spawnTimers.coin >= COIN_SPAWN_SECONDS){
      spawnTimers.coin = 0;
      spawnCoin();
    }
    if(spawnTimers.brain >= BRAINROT_SPAWN_SECONDS){
      spawnTimers.brain = 0;
      // spawn brainrot into a random base's free slot (shop pool is simplified)
      spawnBrainrotPool();
    }

    // decrement locks
    bases.forEach(b=>{
      if(b.lockedUntil && now >= b.lockedUntil){
        b.lockedUntil = 0;
      }
    });

    // update UI timers
    const remainMs = Math.max(0, roundEndTime - now);
    const remainSec = Math.ceil(remainMs/1000);
    ui.timeLeft.textContent = formatTime(remainSec);
    if(remainSec <= 0){
      roundEnd();
    }

    // for demo: award points to players based on number of brainrots in their base
    players.forEach(p=>{
      if(p.inGame){
        const b = bases[p.baseIndex];
        const count = b.slots.filter(x=>x).length;
        p.score = count * 10; // each brainrot 10 points
      }
    });
  } else {
    ui.timeLeft.textContent = 'â€”';
  }
  renderBases();
  renderHud();
}

// format time
function formatTime(s){
  const mm = Math.floor(s/60).toString().padStart(2,'0');
  const ss = Math.floor(s%60).toString().padStart(2,'0');
  return mm+':'+ss;
}

// spawn coin: creates clickable coin element overlayed on arena which can be collected by clicking
function spawnCoin(){
  const coinEl = document.createElement('div');
  coinEl.className = 'badge coin';
  coinEl.style.position = 'absolute';
  // random position inside arena container
  const arenaRect = document.querySelector('.arena').getBoundingClientRect();
  const x = Math.random() * (arenaRect.width - 120) + 20;
  const y = Math.random() * (arenaRect.height - 160) + 20;
  coinEl.style.left = x + 'px';
  coinEl.style.top = y + 'px';
  coinEl.style.cursor = 'pointer';
  coinEl.textContent = 'coin';
  document.querySelector('.arena').appendChild(coinEl);

  const ts = Date.now();
  coinEl.addEventListener('click', ()=>{
    // collect: give coins to player if in game
    if(!isInGame(my.id)){ alert('You must be in the game to collect coins'); coinEl.remove(); return;}
    my.coins += COIN_VALUE;
    document.getElementById('myCoins').textContent = my.coins;
    coinEl.remove();
  });
  // auto remove after lifetime
  setTimeout(()=>{ if(coinEl.parentNode) coinEl.remove(); }, (COIN_LIFETIME*1000)/speedMultiplier);
}

// spawn Brainrot into a random base empty slot (for demo, it's like new ones appear for players to buy/place)
function spawnBrainrotPool(){
  // choose random base
  const idx = Math.floor(Math.random()*bases.length);
  const base = bases[idx];
  // try to place into a free slot OR skip
  for(let s=0;s<SLOTS_PER_BASE;s++){
    if(!base.slots[s]){
      base.slots[s] = {id: uid('b'), name: randName(), ownerId: base.owner ? base.owner.id : null};
      updateSlotUI(idx,s);
      break;
    }
  }
}

// attempt steal from base: choose a random occupied slot that is stealable
function attemptStealFromBase(baseIndex){
  const base = bases[baseIndex];
  if(base.lockedUntil && Date.now() < base.lockedUntil){
    alert('This base is locked and cannot be stolen from yet.');
    return;
  }
  // find a non-empty slot
  const occupiedIndices = base.slots.map((v,i)=>v?i:null).filter(i=>i!==null);
  if(occupiedIndices.length === 0){ alert('No brainrots to steal here!'); return; }
  // pick first occupied for demo
  const slotI = occupiedIndices[Math.floor(Math.random()*occupiedIndices.length)];
  const br = base.slots[slotI];
  // remove from base and give to player (carrying)
  if(my.carrying){ alert('You are already carrying a brainrot. Place it in your base first.'); return; }
  base.slots[slotI] = null;
  my.carrying = br;
  my.carrying.from = baseIndex;
  alert(`You stole "${br.name}" from ${base.owner ? base.owner.username : 'Unknown'}! Now return to your base and click an empty slot to place it.`);
  renderBases();
}

// lock my base
document.getElementById('lockBaseBtn').addEventListener('click', ()=>{
  // must be in game
  if(!isInGame(my.id)){ alert('Join the game to lock your base.'); return; }
  const idx = bases.findIndex(b=>b.owner && b.owner.id===my.id);
  if(idx === -1){ alert('Cannot find your base'); return; }
  bases[idx].lockedUntil = Date.now() + (BASE_LOCK_SECONDS*1000)/speedMultiplier;
  alert(`Your base locked for ${BASE_LOCK_SECONDS} seconds (scaled by demo speed in testing).`);
});

// buy brainrot
document.getElementById('buyBrainBtn').addEventListener('click', ()=>{
  if(my.coins < BRAINROT_COST){ alert('Not enough coins'); return; }
  // place in first empty slot in your base
  const idx = bases.findIndex(b=>b.owner && b.owner.id===my.id);
  if(idx === -1){ alert('You need to be in the game to plant bought brainrots'); return;}
  const base = bases[idx];
  const slotIdx = base.slots.findIndex(s=>!s);
  if(slotIdx === -1){ alert('No empty slots in your base'); return; }
  my.coins -= BRAINROT_COST;
  document.getElementById('myCoins').textContent = my.coins;
  const br = {id: uid('b'), name: randName(), ownerId: my.id};
  base.slots[slotIdx] = br;
  renderBases();
});

// utility: add dummy players to fill game for demo automatically (so you can demo without inviting real people)
function fillWithBots(){
  while(players.length < GAME_PLAYERS){
    const p = {id: uid('bot'), username: 'Bot_'+Math.random().toString(36).slice(2,6), inGame:false, coins:0, score:0};
    players.push(p);
  }
  renderLobby();
  tryStartIfReady();
}

// simple "steal by clicking slot" alternative: clicking an occupied slot steals if allowed & you're in game
document.addEventListener('click', (e)=>{
  if(e.target.closest('.slot')){
    const slotEl = e.target.closest('.slot');
    const parts = slotEl.id.split('-'); // slot-<base>-<s>
    if(parts.length===3){
      const bi = Number(parts[1]), si = Number(parts[2]);
      const slot = bases[bi].slots[si];
      if(slot && isInGame(my.id)){
        // can't steal from own base
        if(bases[bi].owner && bases[bi].owner.id === my.id) return;
        // check lock
        if(bases[bi].lockedUntil && Date.now() < bases[bi].lockedUntil){
          alert('Base is locked!');
          return;
        }
        // steal
        if(my.carrying){ alert('Place your current brainrot first'); return; }
        const br = slot;
        bases[bi].slots[si] = null;
        my.carrying = br;
        my.carrying.from = bi;
        alert(`You stole "${br.name}" from ${bases[bi].owner ? bases[bi].owner.username : 'Player'}! Place it in your base.`);
        renderBases();
      }
    }
  }
});

// helper: determine if current player is owner of any base, otherwise assign them when round starts
function assignMyBaseIfNeeded(){
  const myBaseIdx = bases.findIndex(b=>b.owner && b.owner.id===my.id);
  if(myBaseIdx !== -1) my.baseIndex = myBaseIdx;
}

// simple scoreboard refresh
function renderHud(){
  document.getElementById('myCoins').textContent = my.coins;
  assignMyBaseIfNeeded();
  renderLobby();
}

// helper: check if player is present; if not, add them in queue when clicking join queue (for demo)
document.getElementById('joinBtn').addEventListener('click', ()=>{
  // if bots fill logic: add bots to fill
  // add you explicitly in players list if not present
  if(!players.some(p=>p.id===my.id)){
    const p = {id:my.id, username:my.username, inGame:false, coins:0, score:0};
    players.push(p);
  }
  // fill bots if less than needed
  fillWithBots();
});

// small init
initBases();
renderBases();
renderLobby();
renderHud();
tick(); // initial render

// for convenience, expose some functions to window for manual testing
window.__game = {players,bases,my,tryStartIfReady,roundStart,roundEnd};

</script>
</body>
</html>
